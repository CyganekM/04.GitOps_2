name: Java CI with Maven

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  test:
    name: Run Unit Tests
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven

    - name: Build and test with Maven
      run: mvn clean test

    - name: Test Results
      if: always()
      run: |
        if [ -f "target/surefire-reports/TEST-com.example.TransliteratorTest.xml" ]; then
          echo "‚úÖ –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
          echo "–û—Ç—á–µ—Ç—ã —Ç–µ—Å—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ target/surefire-reports/"
        else
          echo "‚ùå –¢–µ—Å—Ç—ã –Ω–µ –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å –æ—à–∏–±–∫–æ–π"
          exit 1
        fi

    - name: Upload test reports
      uses: actions/upload-artifact@v4
      if: failure()
      with:
        name: test-reports
        path: target/surefire-reports/
        retention-days: 7

  status:
    name: Test Status
    runs-on: ubuntu-latest
    needs: test
    if: always()

    steps:
    - name: Success
      if: needs.test.result == 'success'
      run: |
        echo "üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!"
        echo "‚úÖ Build passing"

    - name: Failure
      if: needs.test.result == 'failure'
      run: |
        echo "‚ùå –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—á–µ—Ç—ã."
        exit 1